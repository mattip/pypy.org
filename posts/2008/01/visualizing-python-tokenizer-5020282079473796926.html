<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Visualizing a Python tokenizer | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2008/01/visualizing-python-tokenizer-5020282079473796926.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<meta name="author" content="The PyPy Team">
<link rel="prev" href="../../2007/12/pypy-winter-sports-sprint-from-12-19th-5592383212609773292.html" title="PyPy Winter Sports Sprint from 12-19th of January in Leysin, Switzerland" type="text/html">
<link rel="next" href="finding-gc-roots-using-llvm-or-parsing-1980376164990001937.html" title="Finding GC roots: using LLVM or parsing assembler files from GCC" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="Visualizing a Python tokenizer">
<meta property="og:url" content="https://www.pypy.org/posts/2008/01/visualizing-python-tokenizer-5020282079473796926.html">
<meta property="og:description" content="Armin and me have been working on PyPy's parser and bytecode compiler for the Python language in the last days. Armin implemented several bytecode optimizations that CPython has since a while whereas ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2008-01-08T11:22:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog">Index</a> </li>  
                    <li> <a href="../../../categories">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://twitter.com/pypyproject">Twitter</a> </li>  
                    <li> <a href="https://quodlibet.duckdns.org/irc/pypy/latest.log.html#irc-end">IRC</a> </li>  
                    <li> <a href="../../../people.html">People</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Visualizing a Python tokenizer</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The PyPy Team
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2008-01-08T11:22:00Z" itemprop="datePublished" title="2008-01-08 11:22">2008-01-08 11:22</time></a>
            </p>
            <p class="commentline">  11 comments
</p>
                <p class="commentline">                <a href="visualizing-python-tokenizer-5020282079473796926.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <p>Armin and me have been working on PyPy's parser and bytecode compiler for the Python language in the last days. Armin implemented several bytecode optimizations that CPython has since a while whereas I tried to refactor our tokenizer and parser (because our existing parser is rather slow and also not very nice code). Armin is mostly done whereas the new parser is not very far yet.</p> <p>What is done, however, is the Python tokenizer. It is implemented in the usual way, by using a set of <a href="https://en.wikipedia.org/wiki/Regular_expression#Formal_language_theory">regular expressions</a> to generate a <a href="https://en.wikipedia.org/wiki/Deterministic_finite_state_machine">deterministic finite automaton</a> (DFA). This automaton is then turned into a big function which does the actual tokenization. Of course the picture is not quite as simple for Python, because it is not possible to tokenize Python using only regular expressions. To generate the proper "indent" and "dedent" tokens it would be necessary to keep state (the previous indentation levels) which a DFA cannot do. This is solved by postprocessing the tokens that the tokenizer produces to turn whitespace tokens into the proper indent and dedent tokens.</p>
<p>For debugging purposes I implemented a visualization tool for DFAs using PyPy's <a href="https://pygame.org/">pygame</a>-based <a href="https://codespeak.net/viewvc/pypy/dist/dotviewer/">graph viewer</a>. The graph viewer is able to visualize interactively any graph given in the graph-description language of <a href="https://graphviz.or/">Graphviz</a>. Looking at the tokenizing DFA for Python is rather instructive, both for understanding how tokenizing works and (maybe) for understanding the Python language. To try it, download the <a href="https://codespeak.net/%7Ecfbolz/tokenizer.dot">dot file of the DFA</a> and run from a pypy checkout:</p>
<p></p>
<pre>$ python pypy/bin/dotviewer.py tokenizer.dot</pre>
<p></p>The following is a screenshot of the graphviewer:
<a href="https://2.bp.blogspot.com/_zICyAWqZbLA/R4NutbgbocI/AAAAAAAAADU/QPPOLMVWp50/s1600-h/graphviewer.png"><img alt="" border="0" id="BLOGGER_PHOTO_ID_5153084125398933954" src="https://2.bp.blogspot.com/_zICyAWqZbLA/R4NutbgbocI/AAAAAAAAADU/QPPOLMVWp50/s320/graphviewer.png" style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer;"></a>
<p>For people who don't want do checkout PyPy I generated a (rather big) <a href="https://codespeak.net/%7Ecfbolz/tokenizer.png">png</a> for the DFA.</p>
<p>Next thing I would like to do (apart from actually finishing the parser, of course :-) ) is visualize the Python grammar itself using <a href="https://en.wikipedia.org/wiki/Syntax_diagram">syntax diagrams</a> or something similar. So far I couldn't really find a program to do that, though.</p>
      </div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../2007/12/pypy-winter-sports-sprint-from-12-19th-5592383212609773292.html" rel="prev" title="PyPy Winter Sports Sprint from 12-19th of January in Leysin, Switzerland">Previous post</a>
            </li>
            <li class="next">
                <a href="finding-gc-roots-using-llvm-or-parsing-1980376164990001937.html" rel="next" title="Finding GC roots: using LLVM or parsing assembler files from GCC">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-8609048123951649403">
        <div class="comment-header">
          <a name="comment-8609048123951649403"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-01-08 16:11</span>:
        </div>
        <div class="comment-content">
          <p>Have you seen <a href="https://flickr.com/photos/nicksieger/281055485/" rel="nofollow">this graph of the Python grammar</a>?</p>
        </div>
      </div>
      <div class="comment comment-412620991796584808">
        <div class="comment-header">
          <a name="comment-412620991796584808"></a>
            <span class="author">Carl Friedrich Bolz-Tereick</span> wrote on <span class="date">2008-01-08 17:52</span>:
        </div>
        <div class="comment-content">
          <p>Hi Robin,<br><br>Yes, this is sort of cool already, but it doesn't really give you as much information as the grammar itself. It's more of an overview-like thing.<br><br>Cheers,<br><br>Carl Friedrich</p>
        </div>
      </div>
      <div class="comment comment-8479632687054194065">
        <div class="comment-header">
          <a name="comment-8479632687054194065"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-01-08 18:05</span>:
        </div>
        <div class="comment-content">
          <p>Check out ANTLRWorks or ANTLRStudio for superb visualization of grammars.</p>
        </div>
      </div>
      <div class="comment comment-401799603589975858">
        <div class="comment-header">
          <a name="comment-401799603589975858"></a>
            <span class="author">Carl Friedrich Bolz-Tereick</span> wrote on <span class="date">2008-01-09 13:57</span>:
        </div>
        <div class="comment-content">
          <p>Yeah, ANTLRWorks seems pretty nice in that respect. Thanks for the hint.</p>
        </div>
      </div>
      <div class="comment comment-5114166570848791420">
        <div class="comment-header">
          <a name="comment-5114166570848791420"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2008-01-18 13:52</span>:
        </div>
        <div class="comment-content">
          <p>Hello!<br><br>I was considering to use<br><br>https://www.antlr.org/wiki/display/ANTLR3/Antlr3PythonTarget<br><br>for a toy language project for uni (Computer Engineering, IT) because I guess ANTLR(works) and its mailing list could help me a lot in understanding the very basics of 'grammar design'...<br><br>Or at least I hope so! :-)<br><br>However, I've also been lurking the PyPy ml for quite a while now and was considering the possibility to implement the whole (*toy*) interpreter in RPython, so to understand a bit more of PyPy's design by actually coding something simple which makes some use of it. :-)<br><br>So, would you consider trying to port the current ANTLR's Python runtime to RPython a good way for me to start doing something with PyPy?<br><br>Would you consider the thing interesting? I know this possibility had been discussed on IRC some times ago and it wasn't thought to be that useful at last, but maybe you discussed the thing some more since then and changed idea, I don't know...<br><br>How would you rate the difficulty of such a task for a PyPy and ANTLR newbie, also? :-)<br><br>I wouldn't try doing that right now, anyway, but maybe in March I should manage to get some spare time for it. In the meantime, I'd try to read as many docs and sources as possible...<br><br>Tell me your opinion, please! :-)<br><br>Cheers,<br>Matteo<br><br>PS: I'm writing here because you were discussing PyPy's Python lexer and somebody wrote about ANTLRworks, but if you think I'd better send this message to the list please just tell me and I'll do so! :-)</p>
        </div>
      </div>
      <div class="comment comment-4541453163496650443">
        <div class="comment-header">
          <a name="comment-4541453163496650443"></a>
            <span class="author">Carl Friedrich Bolz-Tereick</span> wrote on <span class="date">2008-01-18 16:32</span>:
        </div>
        <div class="comment-content">
          <p>Hi Matteo,<br><br>I would post to the pypy-dev mailing list instead, it is better to discuss such longish things there. Thanks for you interest!<br><br>Cheers,<br><br>Carl Friedrich</p>
        </div>
      </div>
      <div class="comment comment-2852285688121849523">
        <div class="comment-header">
          <a name="comment-2852285688121849523"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2008-05-19 14:45</span>:
        </div>
        <div class="comment-content">
          <p>Does it use Graphviz's dot utility for rendering?</p>
        </div>
      </div>
      <div class="comment comment-8592064228245777392">
        <div class="comment-header">
          <a name="comment-8592064228245777392"></a>
            <span class="author">Konrad</span> wrote on <span class="date">2008-06-04 18:36</span>:
        </div>
        <div class="comment-content">
          <p>@techtonik<br><br>Yes, it does.</p>
        </div>
      </div>
      <div class="comment comment-5017852604858126060">
        <div class="comment-header">
          <a name="comment-5017852604858126060"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2008-06-04 18:47</span>:
        </div>
        <div class="comment-content">
          <p>That's bad it cann't be used as a standalone product without the need to install Graphvis.</p>
        </div>
      </div>
      <div class="comment comment-7758160831434035110">
        <div class="comment-header">
          <a name="comment-7758160831434035110"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2009-04-22 02:22</span>:
        </div>
        <div class="comment-content">
          <p>cheap <a href="https://www.wowgold-powerleveling.com/" rel="nofollow">wow power leveling</a> cheapest <a href="https://www.wowpowerleveling.me/" rel="nofollow">wow power leveling</a> buy <a href="https://www.wowgold-powerleveling.com/wow-powerleveling.asp" rel="nofollow">wow power leveling</a> CHEAP <a href="https://www.wowgold-powerleveling.com/" rel="nofollow">power leveling</a> CHEAPEST <a href="https://www.wowgold-powerleveling.com/" rel="nofollow">wow gold</a> BUY <a href="https://www.wowgold-powerleveling.com/" rel="nofollow">wow powerleveling</a></p>
        </div>
      </div>
      <div class="comment comment-3274058047501054546">
        <div class="comment-header">
          <a name="comment-3274058047501054546"></a>
            <span class="author">wow power leveling</span> wrote on <span class="date">2009-04-22 02:27</span>:
        </div>
        <div class="comment-content">
          <p>cheap <a href="https://www.wowgold-powerleveling.com/" rel="nofollow">wow power leveling</a> cheapest <a href="https://www.wowpowerleveling.me/" rel="nofollow">wow power leveling</a> buy <a href="https://www.wowgold-powerleveling.com/wow-powerleveling.asp" rel="nofollow">wow power leveling</a> CHEAP <a href="https://www.wowgold-powerleveling.com/" rel="nofollow">power leveling</a> CHEAPEST <a href="https://www.wowgold-powerleveling.com/" rel="nofollow">wow gold</a> BUY <a href="https://www.wowgold-powerleveling.com/" rel="nofollow">wow powerleveling</a></p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2020/12/mac-meets-arm64-940822335619099039.html" class="listtitle">Mac meets Arm64</a>
      </li>
      <li>
        <a href="/posts/2020/11/pypy-733-triple-release-python-37-36-3446596804408262749.html" class="listtitle">PyPy 7.3.3 triple release: python 3.7, 3.6, and 2.7</a>
      </li>
      <li>
        <a href="/posts/2020/09/pypy-732-triple-release-python-27-36-3980901335490872787.html" class="listtitle">PyPy 7.3.2 triple release: python 2.7, 3.6, and 3.7</a>
      </li>
      <li>
        <a href="/posts/2020/08/pypy-is-on-open-collective-5673322428814364737.html" class="listtitle">PyPy is on Open Collective</a>
      </li>
      <li>
        <a href="/posts/2020/08/a-new-chapter-for-pypy-8388322709667328389.html" class="listtitle">A new chapter for PyPy</a>
      </li>
      <li>
        <a href="/posts/2020/04/pypy-731-released-6266451647387657480.html" class="listtitle">PyPy 7.3.1 released</a>
      </li>
      <li>
        <a href="/posts/2020/03/leysin-2020-sprint-report-764567777353955897.html" class="listtitle">Leysin 2020 Sprint Report</a>
      </li>
      <li>
        <a href="/posts/2020/02/pypy-and-cffi-have-moved-to-heptapod-5791595152472747032.html" class="listtitle">PyPy and CFFI have moved to Heptapod</a>
      </li>
      <li>
        <a href="/posts/2020/01/leysin-winter-sprint-2020-feb-28-march-6349761524797409012.html" class="listtitle">Leysin Winter sprint 2020: Feb 29 - March 8th</a>
      </li>
      <li>
        <a href="/posts/2019/12/pypy-730-released-3614026620096963655.html" class="listtitle">PyPy 7.3.0 released</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (1)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (3)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (2)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (18)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (1)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (47)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releasepypy.html">releasepypy</a> (1)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (3)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../images/pypy-logo-nav-grey.png" alt="PyPy Logo">
</div>
  <div class="logotext">
     Contents © 2021 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>
