<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Trying to get PyPy to run on Python 3.0 | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2008/04/trying-to-get-pypy-to-run-on-python-30-5082015544752137606.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<meta name="author" content="The PyPy Team">
<link rel="prev" href="../03/py-lib-091-released-1654797401128918376.html" title="Py-Lib 0.9.1 released" type="text/html">
<link rel="next" href="other-aprils-fools-ideas-955926452383759016.html" title="Other April's Fools Ideas" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="Trying to get PyPy to run on Python 3.0">
<meta property="og:url" content="https://www.pypy.org/posts/2008/04/trying-to-get-pypy-to-run-on-python-30-5082015544752137606.html">
<meta property="og:description" content="As you surely know, Python 3.0 is coming; recently, they released
Python 3.0 alpha 3, and the final version is expected around
September.
As suggested by the migration guide (in the PEP 3000), we star">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2008-04-01T11:19:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog">Index</a> </li>  
                    <li> <a href="../../../categories">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://twitter.com/pypyproject">Twitter</a> </li>  
                    <li> <a href="https://quodlibet.duckdns.org/irc/pypy/latest.log.html#irc-end">IRC</a> </li>  
                    <li> <a href="../../../people.html">People</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Trying to get PyPy to run on Python 3.0</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The PyPy Team
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2008-04-01T11:19:00Z" itemprop="datePublished" title="2008-04-01 11:19">2008-04-01 11:19</time></a>
            </p>
            <p class="commentline">  5 comments
</p>
                <p class="commentline">                <a href="trying-to-get-pypy-to-run-on-python-30-5082015544752137606.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <p>As you surely know, Python 3.0 is coming; recently, they released
Python 3.0 alpha 3, and the final version is expected around
September.</p>
<p>As suggested by the migration guide (in the PEP 3000), we started by applying
2to3 to our standard interpreter, which is written in RPython (though
we should call it RPython 2.4 now, as opposed to RPython 3.0 -- see
below).</p>
<p>Converting was not seamless, but most of the resulting bugs were due to the
new dict views, str/unicode changes and the missing "reduce" built-in.
After forking and refactoring both our interpreter and the 2to3 script,
the Python interpreter runs on Python 3.0 alpha 3!</p>
<p>Next step was to run 2to3 over the whole translation toolchain,
i.e. the part of PyPy which takes care of analyzing the interpreter in
order to produce efficient executables; after the good results we got
with the standard interpreter, we were confident that it would have
been relatively easy to run 2to3 over it: unfortunately, it was not
:-(.</p>
<p>After letting 2to3 run for days and days uninterrupted, we decided to
kill it: we assume that the toolchain is simply too complex to be
converted in a reasonable amount of time.</p>
<p>So, we needed to think something else; THE great idea we had was to
turn everything upside-down: if we can't port PyPy to Py3k, we can
always port Py3k to PyPy!</p>
<p>Under the hood, the 2to3 conversion tool operates as a graph
transformer: it takes the graph of your program (in the form of Python
2.x source file) and returns a transformed graph of the same program
(in the form of Python 3.0 source file).  Since the entire translation
toolchain of PyPy is based on graph transformations, we could reuse it
to modify the behaviour of the 2to3 tool.  We wrote a general
graph-inverter algorithm which, as the name suggests, takes a graph
transformation and build the inverse transformation; then, we applied
the graph inverter to 2to3, getting something that we called 3to2: it
is important to underline that <strong>3to2 was built by automatically
analysing 2to3 and reversing its operation with only the help of a few
manual hints</strong>. For this reason and because we are not keeping generated
files under version control, we do not need to maintain this new tool in
the Subversion repository.</p>
<p>Once we built 3to2, it was relatively easy to pipe its result to our
interpreter, getting something that can run Python 3.0 programs.</p>
<p>Performance-wise, this approach has the problem of being slower at
import time, because it needs to run (automatically) 3to2 every time
the source is modified; in the future, we plan to apply our JIT
techniques also to this part of the interpreter, trying to mitigate the
slowdown until it is not noticeable anymore to the final user.</p>
<p>In the next weeks, we will work on the transformation (and probably publish
the technique as a research paper, with a title like "Automatic Program
Reversion on Intermediate Languages").</p>
<p><strong>UPDATE:</strong> In case anybody didn't guess or didn't spot the acronym: The above
was an April Fool's joke. Nearly nothing of it is true.</p>
      </div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../03/py-lib-091-released-1654797401128918376.html" rel="prev" title="Py-Lib 0.9.1 released">Previous post</a>
            </li>
            <li class="next">
                <a href="other-aprils-fools-ideas-955926452383759016.html" rel="next" title="Other April's Fools Ideas">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-5874456698443148545">
        <div class="comment-header">
          <a name="comment-5874456698443148545"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-04-01 15:33</span>:
        </div>
        <div class="comment-content">
          <p>"After letting 2to3 run for days and days uninterrupted, we decided to kill it: we assume that the toolchain is simply too complex to be converted in a reasonable amount of time."<br><br>That was silly. Twisted got converted. I suppose that not even a meta-programing-languages-framework can be bigger thaan Twisted. Better luck next year.</p>
        </div>
      </div>
      <div class="comment comment-3770391566082044736">
        <div class="comment-header">
          <a name="comment-3770391566082044736"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-04-01 16:02</span>:
        </div>
        <div class="comment-content">
          <p>I have a working implementation of the Parrot virtual machine in Py3K.  After running it through your converter (my hosting service only runs 2.1!), I find that my implementation now only supports Perl 5 and Snobol.  What gives?</p>
        </div>
      </div>
      <div class="comment comment-8795734594273560583">
        <div class="comment-header">
          <a name="comment-8795734594273560583"></a>
            <span class="author">fumanchu</span> wrote on <span class="date">2008-04-01 16:54</span>:
        </div>
        <div class="comment-content">
          <p>Nice acronym, that.</p>
        </div>
      </div>
      <div class="comment comment-4424210559899619467">
        <div class="comment-header">
          <a name="comment-4424210559899619467"></a>
            <span class="author">Paddy3118</span> wrote on <span class="date">2008-04-01 19:37</span>:
        </div>
        <div class="comment-content">
          <p>Nice one ;-)<br><br>And the best I've read all day!<br><br>- Paddy.</p>
        </div>
      </div>
      <div class="comment comment-5347456076920570612">
        <div class="comment-header">
          <a name="comment-5347456076920570612"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-04-17 20:54</span>:
        </div>
        <div class="comment-content">
          <p>Looks like hosting python 2.5 scripts on a Py3k interpreter might become a USP for PyPY ;)</p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2020/12/mac-meets-arm64-940822335619099039.html" class="listtitle">Mac meets Arm64</a>
      </li>
      <li>
        <a href="/posts/2020/11/pypy-733-triple-release-python-37-36-3446596804408262749.html" class="listtitle">PyPy 7.3.3 triple release: python 3.7, 3.6, and 2.7</a>
      </li>
      <li>
        <a href="/posts/2020/09/pypy-732-triple-release-python-27-36-3980901335490872787.html" class="listtitle">PyPy 7.3.2 triple release: python 2.7, 3.6, and 3.7</a>
      </li>
      <li>
        <a href="/posts/2020/08/pypy-is-on-open-collective-5673322428814364737.html" class="listtitle">PyPy is on Open Collective</a>
      </li>
      <li>
        <a href="/posts/2020/08/a-new-chapter-for-pypy-8388322709667328389.html" class="listtitle">A new chapter for PyPy</a>
      </li>
      <li>
        <a href="/posts/2020/04/pypy-731-released-6266451647387657480.html" class="listtitle">PyPy 7.3.1 released</a>
      </li>
      <li>
        <a href="/posts/2020/03/leysin-2020-sprint-report-764567777353955897.html" class="listtitle">Leysin 2020 Sprint Report</a>
      </li>
      <li>
        <a href="/posts/2020/02/pypy-and-cffi-have-moved-to-heptapod-5791595152472747032.html" class="listtitle">PyPy and CFFI have moved to Heptapod</a>
      </li>
      <li>
        <a href="/posts/2020/01/leysin-winter-sprint-2020-feb-28-march-6349761524797409012.html" class="listtitle">Leysin Winter sprint 2020: Feb 29 - March 8th</a>
      </li>
      <li>
        <a href="/posts/2019/12/pypy-730-released-3614026620096963655.html" class="listtitle">PyPy 7.3.0 released</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (1)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (3)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (2)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (18)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (1)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (47)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releasepypy.html">releasepypy</a> (1)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (3)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../images/pypy-logo-nav-grey.png" alt="PyPy Logo">
</div>
  <div class="logotext">
     Contents © 2021 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>
