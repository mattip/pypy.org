<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Threads and GCs | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2008/05/threads-and-gcs-1126087726480790112.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<meta name="author" content="The PyPy Team">
<link rel="prev" href="progresses-on-cli-jit-backend-front-1021772190959551376.html" title="Progresses on the CLI JIT backend front" type="text/html">
<link rel="next" href="../06/better-profiling-support-for-pypy-1848129914083462080.html" title="Better Profiling Support for PyPy" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="Threads and GCs">
<meta property="og:url" content="https://www.pypy.org/posts/2008/05/threads-and-gcs-1126087726480790112.html">
<meta property="og:description" content="Hi all,

We can now compile a pypy-c that includes both thread support
and one of our semi-advanced garbage collectors.  This means
that threaded Python programs can now run not only with a
better per">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2008-05-28T19:04:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog">Index</a> </li>  
                    <li> <a href="../../../categories">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://twitter.com/pypyproject">Twitter</a> </li>  
                    <li> <a href="https://quodlibet.duckdns.org/irc/pypy/latest.log.html#irc-end">IRC</a> </li>  
                    <li> <a href="../../../people.html">People</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Threads and GCs</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The PyPy Team
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2008-05-28T19:04:00Z" itemprop="datePublished" title="2008-05-28 19:04">2008-05-28 19:04</time></a>
            </p>
            <p class="commentline">  10 comments
</p>
                <p class="commentline">                <a href="threads-and-gcs-1126087726480790112.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <p>Hi all,</p>

<p>We can now compile a pypy-c that includes both thread support
and one of our semi-advanced garbage collectors.  This means
that threaded Python programs can now run not only with a
better performance, but without the annoyances of the Boehm
garbage collector.  (For example, Boehm doesn't like too much
seeing large numbers of __del__(), and our implementation of
ctypes uses them everywhere.)</p>

<p>Magic translation command (example):</p>

<p></p>
<pre>   translate.py --thread --gc=hybrid targetpypystandalone --faassen --allworkingmodules</pre>

<p>Note that multithreading in PyPy is based on a global
interpreter lock, as in CPython.  I imagine that we will get
rid of the global interpreter lock at some point in the future
-- I can certainly see how this might be done in PyPy, unlike
in CPython -- but it will be a lot of work nevertheless.  Given
our current priorities, it will probably not occur soon unless
someone steps in.</p>
      </div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="progresses-on-cli-jit-backend-front-1021772190959551376.html" rel="prev" title="Progresses on the CLI JIT backend front">Previous post</a>
            </li>
            <li class="next">
                <a href="../06/better-profiling-support-for-pypy-1848129914083462080.html" rel="next" title="Better Profiling Support for PyPy">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-9006312843051607594">
        <div class="comment-header">
          <a name="comment-9006312843051607594"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-05-29 00:04</span>:
        </div>
        <div class="comment-content">
          <p>How could GIL be removed from PyPy?</p>
        </div>
      </div>
      <div class="comment comment-6289329603774522282">
        <div class="comment-header">
          <a name="comment-6289329603774522282"></a>
            <span class="author">Armin Rigo</span> wrote on <span class="date">2008-05-29 09:19</span>:
        </div>
        <div class="comment-content">
          <p>By using fine-grained locking: locking every dictionary and list while it is used.  This is what Jython does (or more precisely, what Jython asks the JVM to do for it).  This certainly comes with a performance penalty, so it would only pay off if you actually have and can use multiple CPUs -- which is fine in PyPy: you would just translate different pypy-c's depending on the use case.<br><br>This would be a pain to implement in CPython, in particular because of refcounting.  Even if the Py_INCREF and Py_DECREF macros were made thread-safe, all C-level APIs that manipulate borrowed references might have to be redesigned.</p>
        </div>
      </div>
      <div class="comment comment-4796671256827968112">
        <div class="comment-header">
          <a name="comment-4796671256827968112"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-05-29 10:10</span>:
        </div>
        <div class="comment-content">
          <p>Pyprocessing may serve multi-core cpu needs for the time being, as it's an almost drop-in replacement for the threading module.<br><br>I think it uses ctypes, so it should work with pypy.</p>
        </div>
      </div>
      <div class="comment comment-6307016626118231026">
        <div class="comment-header">
          <a name="comment-6307016626118231026"></a>
            <span class="author">Maciej Fijalkowski</span> wrote on <span class="date">2008-05-29 18:36</span>:
        </div>
        <div class="comment-content">
          <p>pyprocessing has it's own problems (not that threads has no problems at all :)<br><br>1. Memory usage, you need basically n times more memory when n is number of processes<br><br>2. you cannot pass arbitrary data between processes, just stuff that you can marshal/pickle which is a bit huge limitation.<br><br>3. on the other hand, multiple processes provides you better control, although not via threading drop-in replacement.<br><br>Cheers,<br>fijal</p>
        </div>
      </div>
      <div class="comment comment-6960965864968677796">
        <div class="comment-header">
          <a name="comment-6960965864968677796"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-06-04 20:02</span>:
        </div>
        <div class="comment-content">
          <p>The live demos seem to be down... :(</p>
        </div>
      </div>
      <div class="comment comment-3440035023734066320">
        <div class="comment-header">
          <a name="comment-3440035023734066320"></a>
            <span class="author">Maciej Fijalkowski</span> wrote on <span class="date">2008-06-05 02:15</span>:
        </div>
        <div class="comment-content">
          <p>Back online. Our test server is down as well, which makes it a bit hard to know stuff :(</p>
        </div>
      </div>
      <div class="comment comment-6277756132305646554">
        <div class="comment-header">
          <a name="comment-6277756132305646554"></a>
            <span class="author">Connelly Barnes</span> wrote on <span class="date">2008-06-13 00:38</span>:
        </div>
        <div class="comment-content">
          <p>In response to maciej, OSes that implement copy-on-write fork (Linux, but not Windows, unsure about Mac OS X), don't take n times more memory.  Fine-grained locking and an OpenMP-like syntax would be potentially useful.  Maybe you could get a student to prototype these for you.  But I'm sure someone will find a way to parallelize Python eventually, or we'll all switch to some other language, as the number of cores goes to infinity.</p>
        </div>
      </div>
      <div class="comment comment-5415934324189450259">
        <div class="comment-header">
          <a name="comment-5415934324189450259"></a>
            <span class="author">Connelly Barnes</span> wrote on <span class="date">2008-06-17 23:52</span>:
        </div>
        <div class="comment-content">
          <p>In my previous comment, I was partly wrong: COW reduces memory usage, however, in CPython the refcounting will cause the interpreter to write to every area of memory, so the reduction may not be that significant.  Also, IronPython supports fine-grained locks.</p>
        </div>
      </div>
      <div class="comment comment-402454109929765141">
        <div class="comment-header">
          <a name="comment-402454109929765141"></a>
            <span class="author">nekto0n</span> wrote on <span class="date">2008-06-24 23:07</span>:
        </div>
        <div class="comment-content">
          <p>Would it be better to lock not whole mutable object but just an element or slice(for lists) and not lock object for reading operations?<br>It's a common method used in DBMS. A small and fast realisation(if it's possible to create) in PyPy whould be great =)</p>
        </div>
      </div>
      <div class="comment comment-2757612927370606949">
        <div class="comment-header">
          <a name="comment-2757612927370606949"></a>
            <span class="author">Rushen Aly</span> wrote on <span class="date">2009-02-20 18:37</span>:
        </div>
        <div class="comment-content">
          <p>Is there any calendar date for removal of GIL? or is it just a wish. Secondly, what is your speed aim compared with Java?<br>Thanks...<br>Rushen</p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2020/12/mac-meets-arm64-940822335619099039.html" class="listtitle">Mac meets Arm64</a>
      </li>
      <li>
        <a href="/posts/2020/11/pypy-733-triple-release-python-37-36-3446596804408262749.html" class="listtitle">PyPy 7.3.3 triple release: python 3.7, 3.6, and 2.7</a>
      </li>
      <li>
        <a href="/posts/2020/09/pypy-732-triple-release-python-27-36-3980901335490872787.html" class="listtitle">PyPy 7.3.2 triple release: python 2.7, 3.6, and 3.7</a>
      </li>
      <li>
        <a href="/posts/2020/08/pypy-is-on-open-collective-5673322428814364737.html" class="listtitle">PyPy is on Open Collective</a>
      </li>
      <li>
        <a href="/posts/2020/08/a-new-chapter-for-pypy-8388322709667328389.html" class="listtitle">A new chapter for PyPy</a>
      </li>
      <li>
        <a href="/posts/2020/04/pypy-731-released-6266451647387657480.html" class="listtitle">PyPy 7.3.1 released</a>
      </li>
      <li>
        <a href="/posts/2020/03/leysin-2020-sprint-report-764567777353955897.html" class="listtitle">Leysin 2020 Sprint Report</a>
      </li>
      <li>
        <a href="/posts/2020/02/pypy-and-cffi-have-moved-to-heptapod-5791595152472747032.html" class="listtitle">PyPy and CFFI have moved to Heptapod</a>
      </li>
      <li>
        <a href="/posts/2020/01/leysin-winter-sprint-2020-feb-28-march-6349761524797409012.html" class="listtitle">Leysin Winter sprint 2020: Feb 29 - March 8th</a>
      </li>
      <li>
        <a href="/posts/2019/12/pypy-730-released-3614026620096963655.html" class="listtitle">PyPy 7.3.0 released</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (1)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (3)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (2)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (18)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (1)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (47)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releasepypy.html">releasepypy</a> (1)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (3)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../images/pypy-logo-nav-grey.png" alt="PyPy Logo">
</div>
  <div class="logotext">
     Contents © 2021 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>
