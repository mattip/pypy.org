<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sprint Discussions: JIT Generator Planning | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2008/10/sprint-discussions-jit-generator-3301578822967655604.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<meta name="author" content="The PyPy Team">
<link rel="prev" href="sprint-discussions-c-library-bindings-249141169883996521.html" title="Sprint Discussions: C++ Library Bindings" type="text/html">
<link rel="next" href="../11/one-year-pypy-blog-3267056180369310162.html" title="One year PyPy Blog" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="Sprint Discussions: JIT Generator Planning">
<meta property="og:url" content="https://www.pypy.org/posts/2008/10/sprint-discussions-jit-generator-3301578822967655604.html">
<meta property="og:description" content="Background
Finally, the JIT post :-). First some background: Despite our plans at the end
of the EU period, PyPy's Python interpreter didn't get a good and widely
applicable JIT in the last year. The ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2008-10-14T12:28:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog">Index</a> </li>  
                    <li> <a href="../../../categories">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://twitter.com/pypyproject">Twitter</a> </li>  
                    <li> <a href="https://quodlibet.duckdns.org/irc/pypy/latest.log.html#irc-end">IRC</a> </li>  
                    <li> <a href="../../../people.html">People</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Sprint Discussions: JIT Generator Planning</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The PyPy Team
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2008-10-14T12:28:00Z" itemprop="datePublished" title="2008-10-14 12:28">2008-10-14 12:28</time></a>
            </p>
            <p class="commentline">  6 comments
</p>
                <p class="commentline">                <a href="sprint-discussions-jit-generator-3301578822967655604.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <h2>Background</h2>
<p>Finally, the JIT post :-). First some background: Despite our plans at the end
of the EU period, PyPy's Python interpreter didn't get a good and widely
applicable JIT in the last year. The reason for that was that we discovered that
although the basic idea to generate JIT compilers is good, the concrete
prototype made during the EU period is basically flawed. It could have
been pushed a bit farther, but would have run into deep troubles eventually. One
of the problems would have been performance instability: change a seemingly
unrelated bit in your source program, and the performance changes in unexpected
ways, which is clearly not desirable. Another problem with that old approach is
that too much assembler code is generated, leading to memory problems, and also
that the generated assembler is bad in various ways, e.g. it is hard in that
approach to do proper register allocation.</p>
<p>Therefore we decided that it would be worthless to pursue this direction much
further. Instead we tried to research approaches to fixing the inherent
problems. This research was <a class="reference" href="https://morepypy.blogspot.com/2008/06/hi-all-some-news-from-jit-front.html">largely done in Prolog</a> and I eventually wrote my
<a class="reference" href="https://morepypy.blogspot.com/2008/10/prolog-jit-masters-thesis-finished.html">Master's thesis</a> about it. From the Prolog work we got some good insights into
what needs to be done and what sorts of techniques are needed. Also, it inspired
Armin to do some more exploration on a small <a class="reference" href="https://codespeak.net/svn/user/cfbolz/jitpl/branch/pyjitpl/">Python prototype</a> which used the
lessons learned from Prolog and also some additional ideas from tracing JITs. So
far, however, the prototype is neither in RPython, nor much integrated with
PyPy.</p>
<p>This research is not the only thing happening in the JIT-area. During the last
year, Antonio Cuni was working on <a class="reference" href="https://morepypy.blogspot.com/2008/05/progresses-on-cli-jit-backend-front.html">bringing the JIT to pypy-cli</a>. This
consisted mostly of writing a .NET backend for the old JIT-generator. Some
further work is being done since August by John Witulski, who is writing an
AMD64 backend for the JIT-generator for his Bachelor's thesis.</p>

<h2>Where to go from there</h2>
<a href="https://3.bp.blogspot.com/_zICyAWqZbLA/SPSRF3IFyqI/AAAAAAAAAFs/5rg6Vg9wqMI/s1600-h/jit.JPG"><img alt="" border="0" id="BLOGGER_PHOTO_ID_5256986194931468962" src="https://3.bp.blogspot.com/_zICyAWqZbLA/SPSRF3IFyqI/AAAAAAAAAFs/5rg6Vg9wqMI/s320/jit.JPG" style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer;"></a><p>During the sprint we discussed in which directions we should continue now. We
plan to work quite a bit on the JIT in the coming months. Both Armin and Anto
are in Düsseldorf for four months, and them and me plan to mostly work on the
JIT (as well as giving a lecture on "Dynamic Programming Languages", trying to
ensnare some more students).</p>
<p>The first step will be to experiment a bit more with Armin's prototype. So far
it looks rather promising, but there are some unsolved issues that we need to
look into first. The first issue is to think a bit about how to efficiently do
profiling to compile only important code paths. The other large issue are
so-called "virtualizables". Roughly speaking, they are the frame objects of the
interpreter from which the JIT is generated. They need special treatment,
because on the one hand it is important that they get optimized away to make the
code fast, since the frames are accessed all the time for the local variables;
on the other hand they should still be usable for introspection if code is
around that is trying to look into them.</p>
<p>When this is done, the prototype needs to be ported to RPython, which is a
non-trivial task, since it is rather dynamic so far (it is rather important that
the unresolved issues are done before the porting, because once the prototype is
in RPython, experimentation will be harder). The porting has the potential to be
tedious, but in a sense it is "just work", as opposed to unclear research.</p>
<p>At this point it will become important to think about the backend interface. The
interface that the old frontend used to produce assembler code won't be usable
for the new approach, so things need to be rearranged slightly. Afterwards the
backends will have more information and be invoked at a slightly higher level,
which should allow them to produce better code.</p>
<p>When all this is done, the JIT generator will be in a rather good state and it
should become possible (modulo a lot of details, of course), to use it on the
Python interpreter.</p>
<h2>Conclusion</h2>
<p>I am intentionally not attaching any time estimates to this blog post. So far
our time estimates have not been very accurate when it comes to the JIT, which
only lead to disappointment when the JIT failed to materialize. We hope that we
will progress in interesting ways in the next four months, but who knows. Note
that we are really quite disappointed ourselves that it took so much longer than
we planned and hoped. The reason for this is mostly that this work really is
research and sometimes it is just hard to predict what sort of problems turn up.
Partial evaluation (the basis for our JIT generator) is a 30 years old technique
that was always just promising and never really successful, so the fact that we
think we can solve its problems in a few years is very much hubris anyway :-).
On the positive side, we think that we now know these problems much better than
ever before and that we have a plan that has a chance to succeed.</p>
<p>Also we are still convinced that our approach has huge potential, despite the
difficulties. If we manage to pull it off, it should be significantly simpler to
support new language features in the JIT and also to get speedups on some rather
interesting bits of the language. Some ideas we are having include generating a
JIT for the regex engine or speed up ctypes-bindings to be nearly as fast as an
extension module (or faster?). Also the JIT will be such that by construction
the JIT-generated code behaves identical to the original code, which isn't
always true for Psyco, for example.</p>
      </div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="sprint-discussions-c-library-bindings-249141169883996521.html" rel="prev" title="Sprint Discussions: C++ Library Bindings">Previous post</a>
            </li>
            <li class="next">
                <a href="../11/one-year-pypy-blog-3267056180369310162.html" rel="next" title="One year PyPy Blog">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-6648210290105958623">
        <div class="comment-header">
          <a name="comment-6648210290105958623"></a>
            <span class="author">Luis</span> wrote on <span class="date">2008-10-14 19:20</span>:
        </div>
        <div class="comment-content">
          <p>Thank you very much for this post Carl! I have a couple of questions:<br>You said you were experimenting with some ideas from tracing JITs. I wonder how much the new javascript VMs are influencing your work in pypy. Were these techniques  considered from the beginning or this is just because of the latest success of tracemonkey? And if so, are there ideas from Chrome's v8 or Squirellfish than could be applied too?<br>Do they change in any way your expectations regarding the potential of pypy concerning speed?</p>
        </div>
      </div>
      <div class="comment comment-4054740391911355440">
        <div class="comment-header">
          <a name="comment-4054740391911355440"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-10-15 05:42</span>:
        </div>
        <div class="comment-content">
          <p>Hi,<br><br>I quess you will now the work done about hybrid frames in VisualWorks works, but since you mentioned the problem, anyone else could benefit from the following link:<br><br>https://pages.cs.wisc.edu/~cymen/misc/interests/oopsla99-contexts.pdf</p>
        </div>
      </div>
      <div class="comment comment-1330741637107259779">
        <div class="comment-header">
          <a name="comment-1330741637107259779"></a>
            <span class="author">Maciej Fijalkowski</span> wrote on <span class="date">2008-10-15 13:21</span>:
        </div>
        <div class="comment-content">
          <p>@luis: we definitely read same papers (by Michael Franz and others) as tracemonkey authors. Work on tracing jit for pypy is older than release of tracemonkey (it's even older than first work on tracemonkey). Regarding chrome's v8 it seems the main optimization is implementation of hidden classes, which we kind of get for free combining jit and our existing optimization called shared dict.</p>
        </div>
      </div>
      <div class="comment comment-1841066453630053674">
        <div class="comment-header">
          <a name="comment-1841066453630053674"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-10-27 05:59</span>:
        </div>
        <div class="comment-content">
          <p>From the sound of it, it sounds like it would be useful to have a 64-bit version of Psyco, otherwise there is no stopgap in the meantime...</p>
        </div>
      </div>
      <div class="comment comment-7067055714122436884">
        <div class="comment-header">
          <a name="comment-7067055714122436884"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2008-12-01 13:50</span>:
        </div>
        <div class="comment-content">
          <p>When will PyPy match Psyco's speed?</p>
        </div>
      </div>
      <div class="comment comment-5059102671266175555">
        <div class="comment-header">
          <a name="comment-5059102671266175555"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2009-01-18 20:40</span>:
        </div>
        <div class="comment-content">
          <p>Yes, especially on Linux, everything is moving to 64-bit.  If there's no 64-bit Psyco, you can't get the benefits of 64-bit Python (memory) and use Psyco at the same time.</p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2020/12/mac-meets-arm64-940822335619099039.html" class="listtitle">Mac meets Arm64</a>
      </li>
      <li>
        <a href="/posts/2020/11/pypy-733-triple-release-python-37-36-3446596804408262749.html" class="listtitle">PyPy 7.3.3 triple release: python 3.7, 3.6, and 2.7</a>
      </li>
      <li>
        <a href="/posts/2020/09/pypy-732-triple-release-python-27-36-3980901335490872787.html" class="listtitle">PyPy 7.3.2 triple release: python 2.7, 3.6, and 3.7</a>
      </li>
      <li>
        <a href="/posts/2020/08/pypy-is-on-open-collective-5673322428814364737.html" class="listtitle">PyPy is on Open Collective</a>
      </li>
      <li>
        <a href="/posts/2020/08/a-new-chapter-for-pypy-8388322709667328389.html" class="listtitle">A new chapter for PyPy</a>
      </li>
      <li>
        <a href="/posts/2020/04/pypy-731-released-6266451647387657480.html" class="listtitle">PyPy 7.3.1 released</a>
      </li>
      <li>
        <a href="/posts/2020/03/leysin-2020-sprint-report-764567777353955897.html" class="listtitle">Leysin 2020 Sprint Report</a>
      </li>
      <li>
        <a href="/posts/2020/02/pypy-and-cffi-have-moved-to-heptapod-5791595152472747032.html" class="listtitle">PyPy and CFFI have moved to Heptapod</a>
      </li>
      <li>
        <a href="/posts/2020/01/leysin-winter-sprint-2020-feb-28-march-6349761524797409012.html" class="listtitle">Leysin Winter sprint 2020: Feb 29 - March 8th</a>
      </li>
      <li>
        <a href="/posts/2019/12/pypy-730-released-3614026620096963655.html" class="listtitle">PyPy 7.3.0 released</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (1)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (3)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (2)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (18)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (1)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (47)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releasepypy.html">releasepypy</a> (1)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (3)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../images/pypy-logo-nav-grey.png" alt="PyPy Logo">
</div>
  <div class="logotext">
     Contents © 2021 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>
