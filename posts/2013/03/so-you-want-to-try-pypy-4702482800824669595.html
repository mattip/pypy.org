<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>So, you want to try PyPy | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2013/03/so-you-want-to-try-pypy-4702482800824669595.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<meta name="author" content="The PyPy Team">
<link rel="prev" href="numpy-status-update-and-developer-1503421654591696377.html" title="Numpy status update and developer announcement" type="text/html">
<link rel="next" href="../04/pypy-20-beta-2-released-4858660312787995512.html" title="PyPy 2.0 beta 2 released" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="So, you want to try PyPy">
<meta property="og:url" content="https://www.pypy.org/posts/2013/03/so-you-want-to-try-pypy-4702482800824669595.html">
<meta property="og:description" content="Hello.
During the PyCon trip multiple people asked me how exactly they could run
their stuff on PyPy to get the speedups. Now, in an ideal world,
you would just swap CPython with PyPy, everything woul">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2013-03-28T08:57:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog">Index</a> </li>  
                    <li> <a href="../../../categories">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://twitter.com/pypyproject">Twitter</a> </li>  
                    <li> <a href="https://quodlibet.duckdns.org/irc/pypy/latest.log.html#irc-end">IRC</a> </li>  
                    <li> <a href="../../../people.html">People</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">So, you want to try PyPy</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The PyPy Team
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2013-03-28T08:57:00Z" itemprop="datePublished" title="2013-03-28 08:57">2013-03-28 08:57</time></a>
            </p>
            <p class="commentline">  8 comments
</p>
                <p class="commentline">                <a href="so-you-want-to-try-pypy-4702482800824669595.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <div dir="ltr" style="text-align: left;">
<p>Hello.</p>
<p>During the PyCon trip multiple people asked me how exactly they could run
their stuff on PyPy to get the speedups. Now, in an ideal world,
you would just swap CPython with PyPy, everything would run tons of times
faster and everyone would live happily ever after. However, we don't live in
an ideal world and PyPy does not speed up <em>everything</em> you could
potentially run. Chances are that you can run your stuff quite a bit faster, but
it requires quite a bit more R&amp;D than just that. This blog post is an attempt to
explain certain steps that might help. So here we go:</p>
<ul class="simple">
<li>Download and install PyPy. 2.0 beta 1 or upcoming 2.0 beta 2 would be a good
candidate; it's not called a beta for stability reasons.</li>
<li>Run your tests on PyPy. There is absolutely no need for fast software that
does not work. There might be some failures. Usually they're harmless (e.g.
you forgot to close the file); either fix them or at least inspect them. In
short, make sure stuff works.</li>
<li>Inspect your stack. In particular, C extensions, while sometimes working, are
a potential source of instability and slowness. Fortunately,
since the introduction of <a class="reference external" href="https://cffi.readthedocs.org">cffi</a>, the ecosystem of PyPy-compatible software
has been growing. Things I know are written with PyPy in mind:<ul>
<li>the new version of <a class="reference external" href="https://launchpad.net/pyopenssl">pyOpenSSL</a> will support PyPy via cffi</li>
<li>
<a class="reference external" href="https://github.com/chtd/psycopg2cffi">psycopg2cffi</a> is the most actively maintained postgres binding for PyPy,
with pg8000 reported working</li>
<li>mysql has a <a class="reference external" href="https://github.com/quora/mysql-ctypes">ctypes based implementation</a> (although a cffi-based one would
be definitely better)</li>
<li>PyPy 2.0 beta 2 will come with sqlite-using-cffi</li>
<li><a class="reference external" href="https://github.com/amauryfa/lxml/tree/lxml-cffi">lxml-cffi</a></li>
<li>
<a class="reference external" href="https://github.com/unbit/uwsgi-docs">uWSGI</a>, while working, is almost certainly not the best choice. Try
<a class="reference external" href="https://www.tornadoweb.org/en/stable/">tornado</a>, <a class="reference external" href="https://twistedmatrix.com/trac/wiki/TwistedWeb">twisted.web</a>, <a class="reference external" href="https://cyclone.io/">cyclone.io</a>, <a class="reference external" href="https://gunicorn.org/">gunicorn</a> or <a class="reference external" href="https://www.gevent.org/">gevent</a>
(note: gevent support for PyPy is not quite finished; will write about it
in a separate blog post, but you can't just use the main branch of gevent)</li>
<li>consult (and contribute to) <a class="reference external" href="https://bitbucket.org/pypy/compatibility/wiki/Home">pypy compatibility wiki</a> for details (note
that it's community maintained, might be out of date)</li>
</ul>
</li>
</ul>
<ul class="simple">
<li>Have benchmarks. If you don't have benchmarks, then performance does not
matter for you. Since PyPy's warm-up time is bad (and yes, we know, we're
working on it), you should leave ample time for warm-ups. Five to ten seconds
of continuous computation should be enough.</li>
<li>Try them. If you get lucky, the next step might be to deploy and be happy.
If you're unlucky, profile and try to isolate bottlenecks. They might be in
a specific library or they might be in your code. The better you can isolate
them, the higher your chances of understanding what's going on.</li>
<li>Don't take it for granted. PyPy's JIT is very good, but there is a variety
of reasons that it might not work how you expect it to. A lot of times it
starts off slow, but a little optimization can improve the speed as much as
10x. Since PyPy's runtime is less mature than CPython, there are higher
chances of finding an obscure corner of the standard library that might be
atrociously slow.</li>
<li>Most importantly, if you run out of options and you have a reproducible
example, <strong>please report it</strong>. A <a class="reference external" href="https://mail.python.org/mailman/listinfo/pypy-dev">pypy-dev</a> email, popping into <tt class="docutils literal">#pypy</tt>
on <tt class="docutils literal">irc.freenode.net</tt>, or getting hold of me on twitter are good ways.
You can also contact me directly at <em>fijall at gmail.com</em> as well. While
it's cool if the example is slow, a lot of problems only show up on large
and convoluted examples. As long as I can reproduce it on my machine or I can
log in somewhere, I am usually happy to help.</li>
<li>I typically use a combination of <a class="reference external" href="https://bitbucket.org/pypy/jitviewer">jitviewer</a>, <a class="reference external" href="https://valgrind.org/">valgrind</a> and
<a class="reference external" href="https://foss.heptapod.net/pypy/pypy/-/tree/branch/default/rpython/tool/lsprofcalltree.py?at=default">lsprofcalltree</a> to try to guess what's going on. These tools are all
useful, but use them with care. They usually require quite a bit of
understanding before being useful. Also sometimes they're just plain useless
and you need to write your own analysis.</li>
</ul>
<p>I hope this summary of steps to take is useful. We hear a lot of stories
of people trying PyPy, most of them positive, but some of them negative.
If you just post "PyPy didn't work for me" on your blog, that's
cool too, but you're missing an opportunity. The reasons may vary from
something serious like "this is a bad pattern for PyPy GC" to something
completely hilarious like "oh, I left this <tt class="docutils literal">sys._getframe()</tt> somewhere
in my hot loops for debugging" or "I used the <tt class="docutils literal">logging</tt> module which uses
<tt class="docutils literal">sys._getframe()</tt> all over  the place".</p>
<p>Cheers,<br>
fijal</p>
<br>
</div>
      </div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="numpy-status-update-and-developer-1503421654591696377.html" rel="prev" title="Numpy status update and developer announcement">Previous post</a>
            </li>
            <li class="next">
                <a href="../04/pypy-20-beta-2-released-4858660312787995512.html" rel="next" title="PyPy 2.0 beta 2 released">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-6607181682029941499">
        <div class="comment-header">
          <a name="comment-6607181682029941499"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2013-03-28 09:45</span>:
        </div>
        <div class="comment-content">
          <p>waiting for gevent's support</p>
        </div>
      </div>
      <div class="comment comment-2305222820269733527">
        <div class="comment-header">
          <a name="comment-2305222820269733527"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2013-03-28 13:39</span>:
        </div>
        <div class="comment-content">
          <p>Just curious, why is uwsgi not the best choice?</p>
        </div>
      </div>
      <div class="comment comment-2952263789156686215">
        <div class="comment-header">
          <a name="comment-2952263789156686215"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2013-03-28 21:28</span>:
        </div>
        <div class="comment-content">
          <p>I'm also curious what are the issues with uWSGI.</p>
        </div>
      </div>
      <div class="comment comment-6056168514324813949">
        <div class="comment-header">
          <a name="comment-6056168514324813949"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2013-03-28 22:12</span>:
        </div>
        <div class="comment-content">
          <p>As the main uWSGI author i can only confirm the post. Embedding pypy in c applications (not the inverse) is still hacky, and afaik uWSGi is the only project trying to do it. So albeit the combo works, it is only a proof of concept that require still lot of effort (both from pypy and uWSGI) to be production-ready.</p>
        </div>
      </div>
      <div class="comment comment-7282819857047812040">
        <div class="comment-header">
          <a name="comment-7282819857047812040"></a>
            <span class="author">Jacob Stoner</span> wrote on <span class="date">2013-03-28 23:06</span>:
        </div>
        <div class="comment-content">
          <p>looking forward to the post on gevent with pypy</p>
        </div>
      </div>
      <div class="comment comment-9066424293265003814">
        <div class="comment-header">
          <a name="comment-9066424293265003814"></a>
            <span class="author">Josell</span> wrote on <span class="date">2013-03-29 05:04</span>:
        </div>
        <div class="comment-content">
          <p>Ruby or nothing. Sorry.</p>
        </div>
      </div>
      <div class="comment comment-8170443058195613877">
        <div class="comment-header">
          <a name="comment-8170443058195613877"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2013-04-02 13:05</span>:
        </div>
        <div class="comment-content">
          <p>thanks for share<a href="https://www.cool007.org/" rel="nofollow" title="徵信">.</a><a href="https://www.hotprivateeye.com/" rel="nofollow" title="徵信社">.</a><a href="https://www.detective-safeguard.org/" rel="nofollow" title="私家偵探社">.</a><br></p>
        </div>
      </div>
      <div class="comment comment-4281202687678345936">
        <div class="comment-header">
          <a name="comment-4281202687678345936"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2013-04-02 14:46</span>:
        </div>
        <div class="comment-content">
          <p>will there maybe be an asm.js backend for pypy? :) that would be kind of nice. finally python in the browser.<br><br>to me it seems like asm.js will be more successful than google's native client since it is much simpler to implement and since it is a subset of javascript it already works everywhere, just slower.</p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2020/12/mac-meets-arm64-940822335619099039.html" class="listtitle">Mac meets Arm64</a>
      </li>
      <li>
        <a href="/posts/2020/11/pypy-733-triple-release-python-37-36-3446596804408262749.html" class="listtitle">PyPy 7.3.3 triple release: python 3.7, 3.6, and 2.7</a>
      </li>
      <li>
        <a href="/posts/2020/09/pypy-732-triple-release-python-27-36-3980901335490872787.html" class="listtitle">PyPy 7.3.2 triple release: python 2.7, 3.6, and 3.7</a>
      </li>
      <li>
        <a href="/posts/2020/08/pypy-is-on-open-collective-5673322428814364737.html" class="listtitle">PyPy is on Open Collective</a>
      </li>
      <li>
        <a href="/posts/2020/08/a-new-chapter-for-pypy-8388322709667328389.html" class="listtitle">A new chapter for PyPy</a>
      </li>
      <li>
        <a href="/posts/2020/04/pypy-731-released-6266451647387657480.html" class="listtitle">PyPy 7.3.1 released</a>
      </li>
      <li>
        <a href="/posts/2020/03/leysin-2020-sprint-report-764567777353955897.html" class="listtitle">Leysin 2020 Sprint Report</a>
      </li>
      <li>
        <a href="/posts/2020/02/pypy-and-cffi-have-moved-to-heptapod-5791595152472747032.html" class="listtitle">PyPy and CFFI have moved to Heptapod</a>
      </li>
      <li>
        <a href="/posts/2020/01/leysin-winter-sprint-2020-feb-28-march-6349761524797409012.html" class="listtitle">Leysin Winter sprint 2020: Feb 29 - March 8th</a>
      </li>
      <li>
        <a href="/posts/2019/12/pypy-730-released-3614026620096963655.html" class="listtitle">PyPy 7.3.0 released</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (1)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (3)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (2)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (18)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (1)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (47)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releasepypy.html">releasepypy</a> (1)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (3)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../images/pypy-logo-nav-grey.png" alt="PyPy Logo">
</div>
  <div class="logotext">
     Contents © 2021 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>
