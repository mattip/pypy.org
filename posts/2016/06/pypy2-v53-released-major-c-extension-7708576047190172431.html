<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PyPy2 v5.3 released - major C-extension support improvements | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2016/06/pypy2-v53-released-major-c-extension-7708576047190172431.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<meta name="author" content="The PyPy Team">
<link rel="prev" href="../05/pypy33-v52-alpha-1-released-1725927506363370346.html" title="PyPy3.3 v5.2 alpha 1 released" type="text/html">
<link rel="next" href="../07/reverse-debugging-for-python-8854823774141612670.html" title="Reverse debugging for Python" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="PyPy2 v5.3 released - major C-extension support improvements">
<meta property="og:url" content="https://www.pypy.org/posts/2016/06/pypy2-v53-released-major-c-extension-7708576047190172431.html">
<meta property="og:description" content="We have released PyPy2.7 v5.3, about six weeks after PyPy 5.1 and a week after
PyPy3.3 v5.2 alpha 1, the first PyPy release targeting 3.3
compatibility. This new PyPy2.7 release includes major improve">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-06-08T18:45:00Z">
<meta property="article:tag" content="release">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog">Index</a> </li>  
                    <li> <a href="../../../categories">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://twitter.com/pypyproject">Twitter</a> </li>  
                    <li> <a href="https://quodlibet.duckdns.org/irc/pypy/latest.log.html#irc-end">IRC</a> </li>  
                    <li> <a href="../../../people.html">People</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">PyPy2 v5.3 released - major C-extension support improvements</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The PyPy Team
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2016-06-08T18:45:00Z" itemprop="datePublished" title="2016-06-08 18:45">2016-06-08 18:45</time></a>
            </p>
            <p class="commentline">  3 comments
</p>
                <p class="commentline">                <a href="pypy2-v53-released-major-c-extension-7708576047190172431.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <div dir="ltr" style="text-align: left;">
We have released PyPy2.7 v5.3, about six weeks after PyPy 5.1 and a week after
<a class="reference external" href="https://morepypy.blogspot.com/2016/05/pypy33-v52-alpha-1-released.html">PyPy3.3 v5.2 alpha 1</a>, the first PyPy release targeting 3.3
compatibility. This new PyPy2.7 release includes major improvements for the
C-API compatibility layer. In addition to complete support
for <b>lxml</b>, we now pass most (more than 95%) of the upstream <b>numpy</b> test suite. We can build and run <b>scipy</b> and <b>matplotlib</b> as well. Most of the failures have to do with (ab) use of the C-API, for instance writing to a read-only pointer obtained from <span style="font-family: Verdana,sans-serif;">PyString_AsString()</span>.<br><br>
Note that the C-API compatibility layer is significantly slower than CPython, as explained in the <a href="https://morepypy.blogspot.com/2016/02/c-api-support-update.html">blog post</a> about the new strategy for reflection of C objects into the PyPy interpreter.<br><br>
We updated <a class="reference external" href="https://cffi.readthedocs.org/">cffi</a> to version 1.7 (incremental changes which provide a nicer developer experience, documented <a class="reference external" href="https://cffi.readthedocs.io/en/latest/whatsnew.html">here</a>). We would encourage developers to move their C-extension modules to cffi, but are willing to help you work through issues with existing code; come to #pypy on IRC and let us know how we can help you help us do better.<br><br>
You can download the PyPy2 v5.3 release here:<br><blockquote>
<div>
<a class="reference external" href="https://pypy.org/download.html">https://pypy.org/download.html</a>
</div>
</blockquote>
We would like to thank our donors for their continued support of the PyPy
project. We would also like to thank our contributors and
encourage new people to join the project. PyPy has many
layers and we need help with all of them: <a class="reference external" href="https://doc.pypy.org/">PyPy</a> and <a class="reference external" href="https://rpython.readthedocs.org/">RPython</a> documentation
improvements, tweaking popular <a class="reference external" href="https://doc.pypy.org/en/latest/project-ideas.html#make-more-python-modules-pypy-friendly">modules</a> to run on PyPy, or general <a class="reference external" href="https://doc.pypy.org/en/latest/project-ideas.html">help</a>
with making RPython’s JIT even better.<br><br><div class="section" id="what-is-pypy">
<h1 style="text-align: center;">
What is PyPy?</h1>
PyPy is a very compliant Python interpreter, almost a drop-in replacement for CPython 2.7. It’s fast (<a class="reference external" href="https://speed.pypy.org/">PyPy and CPython 2.7</a> performance comparison) due to its integrated tracing JIT compiler.<br><br>
We also welcome developers of other <a class="reference external" href="https://pypyjs.org/">dynamic languages</a> to see what RPython can do for them.<br><br>
This release supports:<br><ul class="simple">
<li>
<b>x86</b> machines on most common operating systems (Linux 32/64, Mac OS X 64, Windows 32, OpenBSD, FreeBSD)</li>
<li>newer <b>ARM</b> hardware (ARMv6 or ARMv7, with VFPv3) running Linux</li>
<li>big- and little-endian variants of <b>PPC64</b> running Linux</li>
<li>
<b>s390x</b> running Linux</li>
</ul>
<br>
</div>
<h1 style="text-align: center;">
Other Highlights</h1>
<h3>
(since the release of PyPy 5.1 in April, 2016)</h3>
<ul style="text-align: left;">
<li>
<div class="first">
<b>New features:</b>
</div>
<ul>
<li>
<div class="first">
Merge a major expansion of the C-API support in cpyext, also expand cpyext tests to allow running them after translation as well as untranslated</div>
</li>
<li>
<div class="first">
Instead of “GIL not held when a CPython C extension module
calls PyXxx”, we now silently acquire/release the GIL.  Helps with
C extension modules that call some PyXxx() functions without
holding the GIL (arguably, they are theoretically buggy).</div>
</li>
<li>
<div class="first">
Support command line -v to trace import statements</div>
</li>
<li>
<div class="first">
Revive traceviewer, a tool to use pygame to view traces</div>
<div class="first">
<br>
</div>
</li>
</ul>
</li>
<li>
<div class="first">
<b><a class="reference external" href="https://bitbucket.org/pypy/numpy">Numpy</a> via our internal _numpypy module:</b>
</div>
<ul class="simple">
<li>Implement ufunc.outer</li>
<li>Move PyPy-specific numpypy headers to a subdirectory (also changed <a class="reference external" href="https://bitbucket.org/pypy/numpy">the repo</a>
accordingly)</li>
</ul>
 <b><br></b>
</li>
<li>
<div class="first">
<b>Performance improvements:</b>
</div>
<ul class="simple">
<li>Use bitstrings to compress lists of descriptors that are attached to an
EffectInfo</li>
<li>Remove most of the _ovf, _zer and _val operations from RPython.  Kills
quite some code internally, and allows the JIT to do better
optimizations: for example, app-level code like <code class="docutils literal"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">2</span></code> or <code class="docutils literal"><span class="pre">x</span> <span class="pre">%</span> <span class="pre">2</span></code>
can now be turned into <code class="docutils literal"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">1</span></code> or <code class="docutils literal"><span class="pre">x</span> <span class="pre">&amp;</span> <span class="pre">1</span></code>, even if x is possibly
negative.</li>
<li>Rework the way registers are moved/spilled in before_call()</li>
</ul>
<br>
</li>
<li>
<div class="first">
<b>Internal refactorings:</b>
</div>
<ul class="simple">
<li>Refactor code to better support Python3-compatible syntax</li>
<li>Reduce the size of generated C sources during translation by
eliminating many many unused struct declarations (Issue #2281)</li>
<li>Reduce the size of generated code by using the same function objects in
all generated subclasses</li>
<li>Share cpyext Py* function wrappers according to the signature, shrinking the
translated libpypy.so by about 10% (without the JIT)</li>
</ul>
</li>
</ul>
Please update, and continue to help us make PyPy better.
Cheers<br>

The PyPy Team<br>
</div>
      </div>
      <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/release.html" rel="tag">release</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../05/pypy33-v52-alpha-1-released-1725927506363370346.html" rel="prev" title="PyPy3.3 v5.2 alpha 1 released">Previous post</a>
            </li>
            <li class="next">
                <a href="../07/reverse-debugging-for-python-8854823774141612670.html" rel="next" title="Reverse debugging for Python">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-1098816110987305560">
        <div class="comment-header">
          <a name="comment-1098816110987305560"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2016-06-09 19:48</span>:
        </div>
        <div class="comment-content">
          <p>"We can build and run scipy and matplotlib as well."<br><br>That's exciting. Are there special instructions needed to build and run spicy and matplotlib with PyPy to see how well it presently works for particular applications? Or is it not even really ready for outsiders to knock it around yet?</p>
        </div>
      </div>
      <div class="comment comment-8533132192353653128">
        <div class="comment-header">
          <a name="comment-8533132192353653128"></a>
            <span class="author">mattip</span> wrote on <span class="date">2016-06-09 23:26</span>:
        </div>
        <div class="comment-content">
          <p>No special instructions, just build from source (binaries precompiled for cpython will not work) using "pypy setup.py install", and let us know how it goes. The order should be numpy, matplotlib, scipy (we have reports that pygtk works too fwiw). <br><br>There have already been some bug reports, so you might want to patch your pymem.h header in pypy/include with this changeset https://bitbucket.org/pypy/pypy/commits/68486f0f79c649514, and if you are on OSX you may need to patch numpy/distutils/fcompiler/gnu.py  with this patch  https://bitbucket.org/pypy/numpy/commits/50bff5807e09721acc4d778ce8ffdef86e2f4c50</p>
        </div>
      </div>
      <div class="comment comment-7803797494251375400">
        <div class="comment-header">
          <a name="comment-7803797494251375400"></a>
            <span class="author">Canesin</span> wrote on <span class="date">2016-06-12 17:38</span>:
        </div>
        <div class="comment-content">
          <p>Great work as usual!</p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2020/12/mac-meets-arm64-940822335619099039.html" class="listtitle">Mac meets Arm64</a>
      </li>
      <li>
        <a href="/posts/2020/11/pypy-733-triple-release-python-37-36-3446596804408262749.html" class="listtitle">PyPy 7.3.3 triple release: python 3.7, 3.6, and 2.7</a>
      </li>
      <li>
        <a href="/posts/2020/09/pypy-732-triple-release-python-27-36-3980901335490872787.html" class="listtitle">PyPy 7.3.2 triple release: python 2.7, 3.6, and 3.7</a>
      </li>
      <li>
        <a href="/posts/2020/08/pypy-is-on-open-collective-5673322428814364737.html" class="listtitle">PyPy is on Open Collective</a>
      </li>
      <li>
        <a href="/posts/2020/08/a-new-chapter-for-pypy-8388322709667328389.html" class="listtitle">A new chapter for PyPy</a>
      </li>
      <li>
        <a href="/posts/2020/04/pypy-731-released-6266451647387657480.html" class="listtitle">PyPy 7.3.1 released</a>
      </li>
      <li>
        <a href="/posts/2020/03/leysin-2020-sprint-report-764567777353955897.html" class="listtitle">Leysin 2020 Sprint Report</a>
      </li>
      <li>
        <a href="/posts/2020/02/pypy-and-cffi-have-moved-to-heptapod-5791595152472747032.html" class="listtitle">PyPy and CFFI have moved to Heptapod</a>
      </li>
      <li>
        <a href="/posts/2020/01/leysin-winter-sprint-2020-feb-28-march-6349761524797409012.html" class="listtitle">Leysin Winter sprint 2020: Feb 29 - March 8th</a>
      </li>
      <li>
        <a href="/posts/2019/12/pypy-730-released-3614026620096963655.html" class="listtitle">PyPy 7.3.0 released</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (1)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (3)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (2)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (18)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (1)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (47)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releasepypy.html">releasepypy</a> (1)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (3)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../images/pypy-logo-nav-grey.png" alt="PyPy Logo">
</div>
  <div class="logotext">
     Contents © 2021 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>
