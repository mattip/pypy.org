<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PyPy Tooling Upgrade: JitViewer and VMProf | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2016/08/pypy-tooling-upgrade-jitviewer-and-5107430577468391432.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<meta name="author" content="The PyPy Team">
<link rel="prev" href="pypy-gets-funding-from-mozilla-for-5569307998787871200.html" title="PyPy gets funding from Mozilla for Python 3.5 support" type="text/html">
<link rel="next" href="pypy2-v54-released-incremental-3611318295736669599.html" title="PyPy2 v5.4 released - incremental improvements and enhancements" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="PyPy Tooling Upgrade: JitViewer and VMProf">
<meta property="og:url" content="https://www.pypy.org/posts/2016/08/pypy-tooling-upgrade-jitviewer-and-5107430577468391432.html">
<meta property="og:description" content="We are happy to announce a major JitViewer (JV) update.
JV allows you to inspect RPython's internal compiler representation (the language in which PyPy is implemented) including the generated machine ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-08-11T11:52:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog">Index</a> </li>  
                    <li> <a href="../../../categories">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://twitter.com/pypyproject">Twitter</a> </li>  
                    <li> <a href="https://quodlibet.duckdns.org/irc/pypy/latest.log.html#irc-end">IRC</a> </li>  
                    <li> <a href="../../../people.html">People</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">PyPy Tooling Upgrade: JitViewer and VMProf</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The PyPy Team
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2016-08-11T11:52:00Z" itemprop="datePublished" title="2016-08-11 11:52">2016-08-11 11:52</time></a>
            </p>
            <p class="commentline">  2 comments
</p>
                <p class="commentline">                <a href="pypy-tooling-upgrade-jitviewer-and-5107430577468391432.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <p>We are happy to announce a major JitViewer (JV) update.<br>
JV allows you to inspect RPython's internal compiler representation (the language in which PyPy is implemented) including the generated machine code of your program. It can graphically show you details of the JIT compiled code and helps you pinpoint issues in your program.<br><br>
VMProf is a statistical CPU profiler for python imposing very little overhead at runtime.<br><br>
Both VMProf and JitViewer share a common goal: Present useful information for your python program.<br>
The combination of both can reveal more information than either alone.<br>
That is the reason why they are now both packaged together.<br>
We also updated <a href="https://vmprof.com/" target="_blank">vmprof.com</a> with various bug fixes and changes including an all new interface to JV.<br><br>
This work was done with the goal of improving tooling and libraries around the Python/PyPy/RPython ecosystem.<br>
Some of the tools we have developed:<br><br></p>
<ul>
<li>
<b>CFFI</b> - Foreign Function Interface that avoids CPyExt (<a href="https://cffi.readthedocs.io/en/latest/" target="_blank">CFFI docs</a>)</li>
<li>
<b>RevDB </b>- A reverse debugger for python (<a href="https://morepypy.blogspot.co.at/2016/07/reverse-debugging-for-python.html" target="_blank">RevDB blog post</a>)</li>
</ul>
<br>
and of course the tools we discuss here:<br><br><ul>
<li>
<b>VMProf</b> - A statistical CPU profiler (<a href="https://vmprof.readthedocs.io/en/latest/" target="_blank">VMProf docs</a>)</li>
<li>
<b>JitViewer</b> - Visualization of the log file produced by RPython (<a href="https://vmprof.readthedocs.io/en/latest/">JitLog docs</a>)</li>
</ul>
<br><h3>
A "brand new" JitViewer</h3>
<br>
JitViewer has two pieces: you create a log file when running your program, and then use a graphic tool to view what happened.<br><br>
The old logging format was a hard-to-maintain, plain-text-logging facility. Frequent changes often broke internal tools.<br>
Additionally, the logging output of a long running program required a lot of disk space.<br><br>
Our new binary format encodes data densely, makes use of some compression (gzip), and tries to remove repetition where possible.<br>
It also supports versioning for future proofing and can be extended easily.<br><br>
And *drumroll* you no longer need to install a tool to view the log yourself<br>
anymore! The whole system moved to vmprof.com and you can use it any time.<br><br>
Sounds great. But what can you do with it? Here are two examples for a PyPy user:<br><h3>
<br>PyPy crashed? Did you discover a bug?</h3>
<br>
For some hard to find bugs it is often necessary to look at the compiled code. The old<br>
procedure often required you to upload a plain text file which was hard to parse and to look through.<br><br>
A better way to share a crash report is to install the ``vmprof`` module from PyPi and execute either of the two commands:<br><span><br></span>
<span># this program does not crash, but has some weird behaviour</span><br><span>$ pypy -m jitlog --web &lt;your program args&gt;</span><br><span>...</span><br><span>PyPy Jitlog: https://vmprof.com/#/&lt;hash&gt;/traces</span><br><span># this program segfaults</span><br><span>$ pypy -m jitlog -o /tmp/log &lt;your program args&gt;</span><br><span>...</span><br><span>&lt;Segfault&gt;</span><br><span>$ pypy -m jitlog --upload /tmp/log</span><br><span>PyPy Jitlog: https://vmprof.com/#/&lt;hash&gt;/traces</span><br><br><br>
Providing the link in the bug report allows PyPy developers to browse and identify potential issues.<br><br><h3>
Speed issues</h3>
<br>
VMProf is a great tool to find hot spots that consume a lot of time in your program. As soon as you have identified code that runs slowly, you can switch to jitlog and maybe pinpoint certain aspects that do not behave as expected. You will find an overview, and are able to browse the generated code. If you cannot make sense of all that, you can just share the link with us and we can have a look too.<br><h3>
<br>Future direction</h3>
<br>
We hope that the new release will help both PyPy developers and PyPy users resolve potential issues and easily point them out.<br><br>
Here are a few ideas what might come in the next few releases:<br><br><br><ul>
<li> Combination of CPU profiles and the JITLOG (sadly did not make it into the current release).</li>
<li>Extend vmprof.com to be able to query vmprof/jitlog. <br>An example query for vmprof: 'methods.callsites() &gt; 5' and<br>for the jitlog would be 'traces.contains('call_assembler').hasbridge('*my_func_name*')'.</li>
<li>Extend the jitlog to capture the information of the optimization stage.</li>
</ul>
<br><br>
Richard Plangger (plan_rich) and the PyPy team<br><div>
<br>
</div>
      </div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="pypy-gets-funding-from-mozilla-for-5569307998787871200.html" rel="prev" title="PyPy gets funding from Mozilla for Python 3.5 support">Previous post</a>
            </li>
            <li class="next">
                <a href="pypy2-v54-released-incremental-3611318295736669599.html" rel="next" title="PyPy2 v5.4 released - incremental improvements and enhancements">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-7842495387820383298">
        <div class="comment-header">
          <a name="comment-7842495387820383298"></a>
            <span class="author">phd</span> wrote on <span class="date">2016-08-11 20:29</span>:
        </div>
        <div class="comment-content">
          <p>https://www.vmprof.com/ doesn't work, but https://vmprof.com/ does. Please fix your DNS.</p>
        </div>
      </div>
      <div class="comment comment-7616288916759646930">
        <div class="comment-header">
          <a name="comment-7616288916759646930"></a>
            <span class="author">Armin Rigo</span> wrote on <span class="date">2016-08-14 08:43</span>:
        </div>
        <div class="comment-content">
          <p>@phd: thanks, fixed the link inside the blog post.  ``www.vmprof.com`` was never intended to work---but that could be considered as a bug; if you feel like it should, please open an issue.</p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2020/12/mac-meets-arm64-940822335619099039.html" class="listtitle">Mac meets Arm64</a>
      </li>
      <li>
        <a href="/posts/2020/11/pypy-733-triple-release-python-37-36-3446596804408262749.html" class="listtitle">PyPy 7.3.3 triple release: python 3.7, 3.6, and 2.7</a>
      </li>
      <li>
        <a href="/posts/2020/09/pypy-732-triple-release-python-27-36-3980901335490872787.html" class="listtitle">PyPy 7.3.2 triple release: python 2.7, 3.6, and 3.7</a>
      </li>
      <li>
        <a href="/posts/2020/08/pypy-is-on-open-collective-5673322428814364737.html" class="listtitle">PyPy is on Open Collective</a>
      </li>
      <li>
        <a href="/posts/2020/08/a-new-chapter-for-pypy-8388322709667328389.html" class="listtitle">A new chapter for PyPy</a>
      </li>
      <li>
        <a href="/posts/2020/04/pypy-731-released-6266451647387657480.html" class="listtitle">PyPy 7.3.1 released</a>
      </li>
      <li>
        <a href="/posts/2020/03/leysin-2020-sprint-report-764567777353955897.html" class="listtitle">Leysin 2020 Sprint Report</a>
      </li>
      <li>
        <a href="/posts/2020/02/pypy-and-cffi-have-moved-to-heptapod-5791595152472747032.html" class="listtitle">PyPy and CFFI have moved to Heptapod</a>
      </li>
      <li>
        <a href="/posts/2020/01/leysin-winter-sprint-2020-feb-28-march-6349761524797409012.html" class="listtitle">Leysin Winter sprint 2020: Feb 29 - March 8th</a>
      </li>
      <li>
        <a href="/posts/2019/12/pypy-730-released-3614026620096963655.html" class="listtitle">PyPy 7.3.0 released</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (1)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (3)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (2)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (18)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (1)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (47)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releasepypy.html">releasepypy</a> (1)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (3)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../images/pypy-logo-nav-grey.png" alt="PyPy Logo">
</div>
  <div class="logotext">
     Contents © 2021 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>
