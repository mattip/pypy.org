<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Let's remove the Global Interpreter Lock | PyPy</title>
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://www.pypy.org/posts/2017/08/lets-remove-global-interpreter-lock-748023554216649595.html">
<link rel="icon" href="../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<meta name="author" content="The PyPy Team">
<link rel="prev" href="../07/binary-wheels-for-pypy-8718353804433344916.html" title="Binary wheels for PyPy" type="text/html">
<link rel="next" href="../10/pypy-v59-released-now-supports-pandas-2261195727261691228.html" title="PyPy v5.9 Released, Now Supports Pandas, NumPy" type="text/html">
<meta property="og:site_name" content="PyPy">
<meta property="og:title" content="Let's remove the Global Interpreter Lock">
<meta property="og:url" content="https://www.pypy.org/posts/2017/08/lets-remove-global-interpreter-lock-748023554216649595.html">
<meta property="og:description" content="Hello everyone
The Python community has been discussing removing the Global Interpreter Lock for
a long time.
There have been various attempts at removing it:
Jython or IronPython successfully removed">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-08-14T14:34:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../index.html">
                    <image id="toplogo" src="../../../images/pypy-logo.svg" width="75px;" alt="PyPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> 
                <a href="#!">Features</a>
                <ul class="nav-dropdown">
<li> <a href="../../../features.html">What is PyPy?</a> </li>  
                    <li> <a href="../../../compat.html">Compatibility</a> </li>  
                    <li> <a href="../../../performance.html">Performance</a> </li>  
                </ul>
</li>
          <li> <a href="../../../download.html">Download</a> </li>  
          <li> <a href="http://doc.pypy.org">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../blog">Index</a> </li>  
                    <li> <a href="../../../categories">Tags</a> </li>  
                    <li> <a href="../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../rss.xml">RSS feed</a> </li>  
                    <li> <a href="https://morepypy.blogspot.com/">Old site</a> </li>  
                </ul>
</li>
            <li> 
                <a href="#!">About</a>
                <ul class="nav-dropdown">
<li> <a href="https://twitter.com/pypyproject">Twitter</a> </li>  
                    <li> <a href="https://quodlibet.duckdns.org/irc/pypy/latest.log.html#irc-end">IRC</a> </li>  
                    <li> <a href="../../../people.html">People</a> </li>  
                    <li> <a href="../../../howtohelp.html">How To Help?</a> </li>  
                    <li> <a href="../../../contact.html">Contact</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Let's remove the Global Interpreter Lock</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The PyPy Team
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-14T14:34:00Z" itemprop="datePublished" title="2017-08-14 14:34">2017-08-14 14:34</time></a>
            </p>
            <p class="commentline">  14 comments
</p>
                <p class="commentline">                <a href="lets-remove-global-interpreter-lock-748023554216649595.html#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <div dir="ltr" style="text-align: left;">
<p>Hello everyone</p>
<p>The Python community has been discussing removing the Global Interpreter Lock for
a long time.
There have been various attempts at removing it:
Jython or IronPython successfully removed it with the help of the underlying
platform, and some have yet to bear fruit, like <a class="reference external" href="https://github.com/larryhastings/gilectomy">gilectomy</a>. Since our <a class="reference external" href="https://morepypy.blogspot.it/2017/03/leysin-winter-sprint-summary.html">February sprint</a> in Leysin,
we have experimented with the topic of GIL removal in the PyPy project.
We believe that the work done in IronPython or Jython can be reproduced with
only a bit more effort in PyPy. Compared to that, removing the GIL in CPython is a much
harder topic, since it also requires tackling the problem of multi-threaded reference
counting. See the section below for further details.</p>
<p>As we announced at EuroPython, what we have so far is a GIL-less PyPy
which can run <strong>very simple</strong> multi-threaded, nicely parallelized, programs.
At the moment, more complicated programs probably segfault. The
remaining 90% (and another 90%) of work is with putting locks in strategic
places so PyPy does not segfault during concurrent accesses to
data structures.</p>
<p>Since such work would complicate the PyPy code base and our day-to-day work,
we would like to judge the interest of the community and the commercial
partners to make it happen (we are not looking for individual
donations at this point).  We estimate a total cost of $50k,
out of which we already have backing for about 1/3 (with a possible 1/3
extra from the STM money, see below).  This would give us a good
shot at delivering a good proof-of-concept working PyPy with no GIL. If we can get a $100k
contract, we will deliver a fully working PyPy interpreter with no GIL as a release,
possibly separate from the default PyPy release.</p>
<p>People asked several questions, so I'll try to answer the technical parts
here.</p>
<h3>What would the plan entail?</h3>
<p>We've already done the work on the Garbage Collector to allow doing multi-
threaded programs in RPython.  "All" that is left is adding locks on mutable
data structures everywhere in the PyPy codebase. Since it would significantly complicate
our workflow, we require real interest in that topic, backed up by
commercial contracts in order to justify the added maintenance burden.</p>
<h3>Why did the STM effort not work out?</h3>
<p>STM was a research project that proved that the idea is possible. However,
the amount of user effort that is required to make programs run in a
parallelizable way is significant, and we never managed to develop tools
that would help in doing so.  At the moment we're not sure if more work
spent on tooling would improve the situation or if the whole idea is really doomed.
The approach also ended up adding significant overhead on single threaded programs,
so in the end it is very easy to make your programs slower.  (We have some money
left in the donation pot for STM which we are not using; according to the rules, we
could declare the STM attempt failed and channel that money towards the present
GIL removal proposal.)</p>
<h3>Wouldn't subinterpreters be a better idea?</h3>
<p>Python is a very mutable language - there are tons of mutable state and
basic objects (classes, functions,...) that are compile-time in other
language but runtime and fully mutable in Python.  In the end, sharing
things between subinterpreters would be restricted to basic immutable
data structures, which defeats the point. Subinterpreters suffers from the same problems as
multiprocessing with no additional benefits.
We believe that reducing mutability to implement subinterpreters is not viable without seriously impacting the
semantics of the language (a conclusion which applies to many other
approaches too).</p>
<h3>Why is it easier to do in PyPy than CPython?</h3>
<p>Removing the GIL in CPython has two problems:</p>
<ul class="simple">
<li>how do we guard access to mutable  data structures with locks and</li>
<li>what to do with reference counting that needs to be guarded.</li>
</ul>
<p>PyPy only has the former problem; the latter doesn't exist,
due to a different garbage collector approach.  Of course the first problem
is a mess too, but at least we are already half-way there. Compared to Jython
or IronPython, PyPy lacks some data structures that are provided by JVM or .NET,
which we would need to implement, hence the problem is a little harder
than on an existing multithreaded platform. However, there is good research
and we know how that problem can be solved.</p>
<p>Best regards,<br>
Maciej Fijalkowski</p>
<br>
</div>
      </div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../07/binary-wheels-for-pypy-8718353804433344916.html" rel="prev" title="Binary wheels for PyPy">Previous post</a>
            </li>
            <li class="next">
                <a href="../10/pypy-v59-released-now-supports-pandas-2261195727261691228.html" rel="next" title="PyPy v5.9 Released, Now Supports Pandas, NumPy">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                <div class="comment-level comment-level-1">
      <div class="comment comment-5672716563453954731">
        <div class="comment-header">
          <a name="comment-5672716563453954731"></a>
            <span class="author">Patrick</span> wrote on <span class="date">2017-08-14 18:03</span>:
        </div>
        <div class="comment-content">
          <p>Where can one donate? Is there a specific page for it? :)</p>
        </div>
      </div>
      <div class="comment comment-8545687788114187699">
        <div class="comment-header">
          <a name="comment-8545687788114187699"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2017-08-14 20:12</span>:
        </div>
        <div class="comment-content">
          <p>Where can we we donate or forward a link to managing directors for corporate donations?</p>
        </div>
      </div>
      <div class="comment comment-3082635565260388758">
        <div class="comment-header">
          <a name="comment-3082635565260388758"></a>
            <span class="author">funny_falcon</span> wrote on <span class="date">2017-08-14 21:29</span>:
        </div>
        <div class="comment-content">
          <p>Neither .Net, nor Java put locks around every mutable access. Why the hell PyPy should?</p>
        </div>
      </div>
      <div class="comment comment-5938406748463360521">
        <div class="comment-header">
          <a name="comment-5938406748463360521"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2017-08-15 00:29</span>:
        </div>
        <div class="comment-content">
          <p>It sounds to me like you are just looking for money to spend.  I see no reliable or commercial deliverable coming out of this effort (you listed a bucketload of caveats already).  If it were doable in $100k, it would have been done long ago, no?  Caveat Emptor to those who toss their money at this.</p>
        </div>
      </div>
      <div class="comment comment-1010640416566860229">
        <div class="comment-header">
          <a name="comment-1010640416566860229"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2017-08-15 06:05</span>:
        </div>
        <div class="comment-content">
          <p>200+ comments about this article are at: https://news.ycombinator.com/item?id=15008636</p>
        </div>
      </div>
      <div class="comment comment-6996417011876857448">
        <div class="comment-header">
          <a name="comment-6996417011876857448"></a>
            <span class="author">Zunzster</span> wrote on <span class="date">2017-08-15 06:20</span>:
        </div>
        <div class="comment-content">
          <p>@funny_falcon: I don't read this as them arguing for putting "putting locks around *every* mutable access". Rather, just the core shared-mutable pieces of the run-time library and infrastructure, which in .NET and the JVM are provided by the VM itself for Jython and IronPython but which PyPy has to implement.<br><br>@scott_taggart: Your vision seems limited. Perhaps you aren't familiar with the PyPy team's strong history of delivering. It may well be 'doable in $100K' but how is that supposed to have spontaneously happened already without a viable plan and a trusted team which is exactly what the PyPy project is?<br><br>I always thought the STM concept was really clever and elegant in theory but that the overhead involved, both in recording and rollback-retries, could impact forward progress too much to be viable in practice. Essentially, STM and locks are dual's of each other, with STM having better composition and locks less overhead.<br><br>At least with a more traditional locking approach, the locks are still being inserted by the interpreter/library, so they can be reasoned about more carefully (and even instrumented programmatically) to avoid some of the classic problems with lock-based designs whilst regaining the performance lost to STM overhead.<br><br>If anyone can pull it off, the PyPy team can :-)</p>
        </div>
      </div>
      <div class="comment comment-8135785294504328819">
        <div class="comment-header">
          <a name="comment-8135785294504328819"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2017-08-15 08:31</span>:
        </div>
        <div class="comment-content">
          <p>+1</p>
        </div>
      </div>
      <div class="comment comment-6301756632403452325">
        <div class="comment-header">
          <a name="comment-6301756632403452325"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2017-08-15 09:19</span>:
        </div>
        <div class="comment-content">
          <p>Why not rather implement immutable datastructures like Clojure does?</p>
        </div>
      </div>
      <div class="comment comment-4811076520752141457">
        <div class="comment-header">
          <a name="comment-4811076520752141457"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2017-08-15 12:42</span>:
        </div>
        <div class="comment-content">
          <p>Oh, just shut up and take my money.</p>
        </div>
      </div>
      <div class="comment comment-24657593351683103">
        <div class="comment-header">
          <a name="comment-24657593351683103"></a>
            <span class="author">Anonymous</span> wrote on <span class="date">2017-08-15 14:10</span>:
        </div>
        <div class="comment-content">
          <p>I have been very impressed with the PyPy developers accomplishments to date and sincerely hope that they find corporate sponsors for this worthwhile endeavor.</p>
        </div>
      </div>
      <div class="comment comment-8124809365700055850">
        <div class="comment-header">
          <a name="comment-8124809365700055850"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2017-08-15 20:23</span>:
        </div>
        <div class="comment-content">
          <p>How can people donate? $50k seems a bargain for such an important achievement. That's pocket change to most moderately sized companies.</p>
        </div>
      </div>
      <div class="comment comment-3965110024211126189">
        <div class="comment-header">
          <a name="comment-3965110024211126189"></a>
            <span class="author">Joce</span> wrote on <span class="date">2017-08-16 05:17</span>:
        </div>
        <div class="comment-content">
          <p>Sounds good, perhaps time to mark the STM effort as stale?</p>
        </div>
      </div>
      <div class="comment comment-1170540913465684629">
        <div class="comment-header">
          <a name="comment-1170540913465684629"></a>
            <span class="author">Unknown</span> wrote on <span class="date">2017-09-13 23:22</span>:
        </div>
        <div class="comment-content">
          <p>This would be awesome, please. :(</p>
        </div>
      </div>
      <div class="comment comment-2559918787749984069">
        <div class="comment-header">
          <a name="comment-2559918787749984069"></a>
            <span class="author">PvdE</span> wrote on <span class="date">2017-10-04 06:59</span>:
        </div>
        <div class="comment-content">
          <p>I donated to the original STM and would be happy if it were reallocated to this.<br></p>
        </div>
      </div>
         </div>

          </section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The PyPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/pypy/pypy.org">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/posts/2020/12/mac-meets-arm64-940822335619099039.html" class="listtitle">Mac meets Arm64</a>
      </li>
      <li>
        <a href="/posts/2020/11/pypy-733-triple-release-python-37-36-3446596804408262749.html" class="listtitle">PyPy 7.3.3 triple release: python 3.7, 3.6, and 2.7</a>
      </li>
      <li>
        <a href="/posts/2020/09/pypy-732-triple-release-python-27-36-3980901335490872787.html" class="listtitle">PyPy 7.3.2 triple release: python 2.7, 3.6, and 3.7</a>
      </li>
      <li>
        <a href="/posts/2020/08/pypy-is-on-open-collective-5673322428814364737.html" class="listtitle">PyPy is on Open Collective</a>
      </li>
      <li>
        <a href="/posts/2020/08/a-new-chapter-for-pypy-8388322709667328389.html" class="listtitle">A new chapter for PyPy</a>
      </li>
      <li>
        <a href="/posts/2020/04/pypy-731-released-6266451647387657480.html" class="listtitle">PyPy 7.3.1 released</a>
      </li>
      <li>
        <a href="/posts/2020/03/leysin-2020-sprint-report-764567777353955897.html" class="listtitle">Leysin 2020 Sprint Report</a>
      </li>
      <li>
        <a href="/posts/2020/02/pypy-and-cffi-have-moved-to-heptapod-5791595152472747032.html" class="listtitle">PyPy and CFFI have moved to Heptapod</a>
      </li>
      <li>
        <a href="/posts/2020/01/leysin-winter-sprint-2020-feb-28-march-6349761524797409012.html" class="listtitle">Leysin Winter sprint 2020: Feb 29 - March 8th</a>
      </li>
      <li>
        <a href="/posts/2019/12/pypy-730-released-3614026620096963655.html" class="listtitle">PyPy 7.3.0 released</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2007/">2007</a> (19)
            </li>
            <li><a class="reference" href="/2008/">2008</a> (62)
            </li>
            <li><a class="reference" href="/2009/">2009</a> (38)
            </li>
            <li><a class="reference" href="/2010/">2010</a> (44)
            </li>
            <li><a class="reference" href="/2011/">2011</a> (43)
            </li>
            <li><a class="reference" href="/2012/">2012</a> (44)
            </li>
            <li><a class="reference" href="/2013/">2013</a> (46)
            </li>
            <li><a class="reference" href="/2014/">2014</a> (22)
            </li>
            <li><a class="reference" href="/2015/">2015</a> (20)
            </li>
            <li><a class="reference" href="/2016/">2016</a> (20)
            </li>
            <li><a class="reference" href="/2017/">2017</a> (13)
            </li>
            <li><a class="reference" href="/2018/">2018</a> (12)
            </li>
            <li><a class="reference" href="/2019/">2019</a> (12)
            </li>
            <li><a class="reference" href="/2020/">2020</a> (9)
            </li>
          </ul>
        </div>


          <div id="global-tag-list">
          <h2>
            Tags
          </h2>
          <ul>
            <li><a class="reference" href="/categories/arm.html">arm</a> (1)</li>
            <li><a class="reference" href="/categories/cli.html">cli</a> (1)</li>
            <li><a class="reference" href="/categories/compiler.html">compiler</a> (1)</li>
            <li><a class="reference" href="/categories/cpyext.html">cpyext</a> (3)</li>
            <li><a class="reference" href="/categories/cpython.html">CPython</a> (3)</li>
            <li><a class="reference" href="/categories/ep2008.html">ep2008</a> (1)</li>
            <li><a class="reference" href="/categories/extension-modules.html">extension modules</a> (2)</li>
            <li><a class="reference" href="/categories/graalpython.html">GraalPython</a> (1)</li>
            <li><a class="reference" href="/categories/hpy.html">hpy</a> (1)</li>
            <li><a class="reference" href="/categories/heptapod.html">Heptapod</a> (1)</li>
            <li><a class="reference" href="/categories/jit.html">jit</a> (18)</li>
            <li><a class="reference" href="/categories/jython.html">jython</a> (1)</li>
            <li><a class="reference" href="/categories/kcachegrind.html">kcachegrind</a> (1)</li>
            <li><a class="reference" href="/categories/numpy.html">numpy</a> (24)</li>
            <li><a class="reference" href="/categories/parser.html">parser</a> (1)</li>
            <li><a class="reference" href="/categories/profiling.html">profiling</a> (1)</li>
            <li><a class="reference" href="/categories/pypy.html">pypy</a> (6)</li>
            <li><a class="reference" href="/categories/pypy3.html">pypy3</a> (16)</li>
            <li><a class="reference" href="/categories/pyqt4.html">PyQt4</a> (1)</li>
            <li><a class="reference" href="/categories/release.html">release</a> (47)</li>
            <li><a class="reference" href="/categories/releasecffi.html">releasecffi</a> (3)</li>
            <li><a class="reference" href="/categories/releasepypy.html">releasepypy</a> (1)</li>
            <li><a class="reference" href="/categories/releaserevdb.html">releaserevdb</a> (1)</li>
            <li><a class="reference" href="/categories/releasestm.html">releasestm</a> (1)</li>
            <li><a class="reference" href="/categories/revdb.html">revdb</a> (1)</li>
            <li><a class="reference" href="/categories/roadmap.html">roadmap</a> (1)</li>
            <li><a class="reference" href="/categories/rpyc.html">RPyC</a> (1)</li>
            <li><a class="reference" href="/categories/speed.html">speed</a> (3)</li>
            <li><a class="reference" href="/categories/sprint.html">sprint</a> (3)</li>
            <li><a class="reference" href="/categories/stm.html">stm</a> (14)</li>
            <li><a class="reference" href="/categories/sun.html">sun</a> (1)</li>
            <li><a class="reference" href="/categories/smalltalk.html">Smalltalk</a> (1)</li>
            <li><a class="reference" href="/categories/squeak.html">Squeak</a> (1)</li>
            <li><a class="reference" href="/categories/unicode.html">unicode</a> (1)</li>
            <li><a class="reference" href="/categories/valgrind.html">valgrind</a> (1)</li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../images/pypy-logo-nav-grey.png" alt="PyPy Logo">
</div>
  <div class="logotext">
     Contents © 2021 <a href="mailto:pypy-dev@pypy.org">The PyPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>
